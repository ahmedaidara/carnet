<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StudySync - Accueil</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <style>
        :root {
            --primary: #6C63FF;
            --secondary: #4D44DB;
            --accent: #FF6584;
            --light: #F8F9FA;
            --dark: #343A40;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F5F7FB;
        }
        .greeting {
            animation: fadeIn 1s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .subject-card {
            transition: all 0.3s ease;
        }
        .subject-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .countdown {
            font-feature-settings: "tnum";
        }
        .nav-item.active {
            border-bottom: 3px solid var(--primary);
        }
        input:focus, textarea:focus, select:focus {
            outline: none !important;
            box-shadow: 0 0 0 2px rgba(108, 99, 255, 0.2) !important;
        }
        [contenteditable]:focus {
            outline: none;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">
    <!-- Header -->
    <header class="bg-white shadow-sm sticky top-0 z-10">
        <div class="container mx-auto px-4 py-3 flex items-center justify-between">
            <div class="flex items-center space-x-2">
                <i data-feather="book-open" class="text-purple-600"></i>
                <h1 class="text-xl font-bold text-gray-800">StudySync</h1>
            </div>
            
            <div class="relative w-1/2">
                <input type="text" placeholder="Rechercher une matière, document..." 
                       class="w-full px-4 py-2 rounded-full border border-gray-200 focus:border-purple-400 focus:ring-0">
                <i data-feather="search" class="absolute right-3 top-2.5 text-gray-400"></i>
            </div>
            
            <div class="flex items-center space-x-4">
                <div id="greeting" class="greeting font-medium text-gray-700">Bonjour</div>
                <div class="w-8 h-8 rounded-full bg-purple-100 flex items-center justify-center">
                    <i data-feather="user" class="text-purple-600"></i>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow container mx-auto px-4 py-6">
        <!-- Date & Countdown -->
        <section class="mb-8 bg-white rounded-xl shadow-sm p-6">
            <div class="flex flex-wrap items-center justify-between gap-4">
                <div class="flex items-center space-x-4">
                    <div class="w-12 h-12 rounded-full bg-purple-100 flex items-center justify-center">
                        <i data-feather="calendar" class="text-purple-600"></i>
                    </div>
              <div>
    <div class="text-gray-500">Aujourd'hui</div>
    <div id="current-date" class="font-semibold text-lg">Lundi 12 juin 2023</div>
    <div id="current-time" class="font-semibold text-purple-600 text-sm"></div>
</div>
                </div>
                
               <div id="reminder-display" class="flex-grow max-w-md px-4">
    <!-- Les rappels seront affichés ici dynamiquement -->
</div>
                
                <div class="flex items-center space-x-4">
                 <div class="text-right">
    <div class="text-gray-500">Prochain examen</div>
    <div id="next-exam" class="font-bold text-purple-600">Chargement...</div>
</div>
                </div>
            </div>
        </section>

        <!-- Tomorrow's Schedule -->
     <!-- Prochaines matières -->
<section class="mb-8">
    <h2 class="text-xl font-semibold mb-4 flex items-center">
        <i data-feather="clock" class="mr-2"></i> À suivre
    </h2>
    <div class="bg-white rounded-xl shadow-sm p-4">
        <div class="flex justify-between items-center mb-3">
            <h3 class="font-medium">Prochaines matières</h3>
            <a href="schedule.html" class="text-sm text-purple-600 flex items-center">
                Voir plus <i data-feather="chevron-right" class="ml-1 w-4 h-4"></i>
            </a>
        </div>
        <div id="next-subjects" class="space-y-3">
            <!-- Les 2 prochaines matières seront affichées ici dynamiquement -->
        </div>
    </div>
</section>

        <!-- Bulletin & Evolution -->
        <section class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
            <!-- Bulletin -->
            <div class="bg-white rounded-xl shadow-sm p-6">
                <h2 class="text-xl font-semibold mb-4 flex items-center">
                    <i data-feather="file-text" class="mr-2"></i> Bulletin de notes
                </h2>
                <div class="mb-4">
                    <div class="text-gray-500 mb-1">Dernier bulletin</div>
                    <div class="font-medium">1er Trimestre 2023-2024</div>
                    <div class="text-sm text-gray-500">Moyenne: 14.5/20</div>
                </div>
                <a href="grades.html" class="inline-flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition">
                    <i data-feather="plus" class="mr-2 w-4 h-4"></i> Nouveau bulletin
                </a>
            </div>
            
            <!-- Evolution -->
            <div class="bg-white rounded-xl shadow-sm p-6">
                <h2 class="text-xl font-semibold mb-4 flex items-center">
                    <i data-feather="trending-up" class="mr-2"></i> Évolution
                </h2>
                <div class="h-48">
                    <canvas id="evolutionChart"></canvas>
                </div>
                <div class="mt-4 text-right">
                    <a href="grades.html#evolution" class="text-purple-600 text-sm flex items-center justify-end">
                        Voir le détail <i data-feather="chevron-right" class="ml-1 w-4 h-4"></i>
                    </a>
                </div>
            </div>
        </section>

        <!-- Matières récentes -->
        <section>
            <h2 class="text-xl font-semibold mb-4 flex items-center">
                <i data-feather="layers" class="mr-2"></i> Mes matières récentes
            </h2>
            <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4">
                <a href="subject.html?id=1" class="subject-card bg-white rounded-xl shadow-sm p-4 flex flex-col items-center text-center hover:shadow-md">
                    <div class="w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center mb-2">
                        <i data-feather="code" class="text-blue-600"></i>
                    </div>
                    <div class="font-medium">Informatique</div>
                    <div class="text-xs text-gray-500">Coeff: 3</div>
                </a>
                <a href="subject.html?id=2" class="subject-card bg-white rounded-xl shadow-sm p-4 flex flex-col items-center text-center hover:shadow-md">
                    <div class="w-12 h-12 rounded-full bg-red-100 flex items-center justify-center mb-2">
                        <i data-feather="atom" class="text-red-600"></i>
                    </div>
                    <div class="font-medium">Physique</div>
                    <div class="text-xs text-gray-500">Coeff: 4</div>
                </a>
                <a href="subject.html?id=3" class="subject-card bg-white rounded-xl shadow-sm p-4 flex flex-col items-center text-center hover:shadow-md">
                    <div class="w-12 h-12 rounded-full bg-green-100 flex items-center justify-center mb-2">
                        <i data-feather="divide" class="text-green-600"></i>
                    </div>
                    <div class="font-medium">Maths</div>
                    <div class="text-xs text-gray-500">Coeff: 5</div>
                </a>
                <a href="subject.html?id=4" class="subject-card bg-white rounded-xl shadow-sm p-4 flex flex-col items-center text-center hover:shadow-md">
                    <div class="w-12 h-12 rounded-full bg-yellow-100 flex items-center justify-center mb-2">
                        <i data-feather="globe" class="text-yellow-600"></i>
                    </div>
                    <div class="font-medium">Histoire</div>
                    <div class="text-xs text-gray-500">Coeff: 2</div>
                </a>
            </div>
        </section>
    </main>

    <!-- Bottom Navigation -->
    <nav class="bg-white border-t border-gray-200 fixed bottom-0 w-full">
        <div class="container mx-auto flex justify-around">
            <a href="index.html" class="nav-item active flex flex-col items-center py-3 px-4 text-purple-600">
                <i data-feather="home" class="w-6 h-6"></i>
                <span class="text-xs mt-1">Accueil</span>
            </a>
            <a href="subjects.html" class="nav-item flex flex-col items-center py-3 px-4 text-gray-500 hover:text-purple-600">
                <i data-feather="book" class="w-6 h-6"></i>
                <span class="text-xs mt-1">Matières</span>
            </a>
            <a href="library.html" class="nav-item flex flex-col items-center py-3 px-4 text-gray-500 hover:text-purple-600">
                <i data-feather="bookmark" class="w-6 h-6"></i>
                <span class="text-xs mt-1">Bibliothèque</span>
            </a>
            <a href="schedule.html" class="nav-item flex flex-col items-center py-3 px-4 text-gray-500 hover:text-purple-600">
                <i data-feather="calendar" class="w-6 h-6"></i>
                <span class="text-xs mt-1">Emploi du temps</span>
            </a>
            <a href="settings.html" class="nav-item flex flex-col items-center py-3 px-4 text-gray-500 hover:text-purple-600">
                <i data-feather="settings" class="w-6 h-6"></i>
                <span class="text-xs mt-1">Paramètres</span>
            </a>
        </div>
    </nav>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Initialize Feather Icons
      // Initialize the page
function initPage() {
    feather.replace();
    
    // Set current date and time
    const now = new Date();
    const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
    document.getElementById('current-date').textContent = now.toLocaleDateString('fr-FR', options);
    
    // Start real-time clock
    updateCurrentTime();
    setInterval(updateCurrentTime, 1000);
    
    // Dynamic greeting
    const hour = now.getHours();
    let greeting;
    
    if (hour < 12) {
        greeting = "Bonjour";
    } else if (hour < 18) {
        greeting = "Bonsoir";
    } else {
        greeting = "Bonsoir";
    }
    
    document.getElementById('greeting').textContent = greeting;
    
    // Load data from schedule page
    loadNextExam();
    loadNextSubjects();
    loadFilteredReminders();
    
    // Set up intervals to refresh data
    setInterval(loadNextExam, 60000); // Refresh every minute
    setInterval(loadNextSubjects, 60000); // Refresh every minute
}
        
      
   // Update current time
function updateCurrentTime() {
    const now = new Date();
    const timeString = now.toLocaleTimeString('fr-FR', { 
        hour: '2-digit', 
        minute: '2-digit',
        second: '2-digit'
    });
    document.getElementById('current-time').textContent = timeString;
}
setInterval(updateCurrentTime, 1000);
updateCurrentTime();

// Load next exam from schedule
function loadNextExam() {
    const exams = JSON.parse(localStorage.getItem('exams')) || [];
    const now = new Date();
    
    // Filter future exams and sort by date
    const futureExams = exams
        .filter(exam => {
            const examDate = new Date(exam.date + 'T' + exam.time);
            return examDate > now;
        })
        .sort((a, b) => new Date(a.date + 'T' + a.time) - new Date(b.date + 'T' + b.time));
    
    const nextExamElement = document.getElementById('next-exam');
    
    if (futureExams.length > 0) {
        const nextExam = futureExams[0];
        const examDate = new Date(nextExam.date + 'T' + nextExam.time);
        const diffTime = examDate - now;
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        
        if (diffDays === 0) {
            nextExamElement.textContent = `${nextExam.name} - Aujourd'hui ${nextExam.time}`;
        } else if (diffDays === 1) {
            nextExamElement.textContent = `${nextExam.name} - Demain ${nextExam.time}`;
        } else {
            nextExamElement.textContent = `${nextExam.name} - Dans ${diffDays} jours`;
        }
    } else {
        nextExamElement.textContent = "Aucun examen prévu";
    }
}

// Load next subjects
function loadNextSubjects() {
    const schedules = JSON.parse(localStorage.getItem('schedules')) || [];
    const now = new Date();
    const currentDay = now.toLocaleDateString('fr-FR', { weekday: 'long' });
    const currentTime = now.toTimeString().substring(0, 5); // HH:MM format
    
    let allSubjects = [];
    
    // Collect all subjects from all schedules
    schedules.forEach(schedule => {
        if (schedule.data && schedule.days) {
            schedule.days.forEach(day => {
                if (schedule.data[day]) {
                    Object.keys(schedule.data[day]).forEach(timeSlotId => {
                        const subject = schedule.data[day][timeSlotId];
                        if (subject && subject.trim() !== '') {
                            const timeSlot = schedule.timeSlots.find(ts => ts.id === timeSlotId);
                            if (timeSlot) {
                                allSubjects.push({
                                    subject: subject,
                                    day: day,
                                    startTime: timeSlot.start,
                                    scheduleName: schedule.name
                                });
                            }
                        }
                    });
                }
            });
        }
    });
    
    // Sort subjects by day and time
    const dayOrder = ['Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi', 'Dimanche'];
    allSubjects.sort((a, b) => {
        const dayDiff = dayOrder.indexOf(a.day) - dayOrder.indexOf(b.day);
        if (dayDiff !== 0) return dayDiff;
        return a.startTime.localeCompare(b.startTime);
    });
    
    // Display next 2 subjects
    const nextSubjectsContainer = document.getElementById('next-subjects');
    nextSubjectsContainer.innerHTML = '';
    
    const nextSubjects = allSubjects.slice(0, 2);
    
    if (nextSubjects.length > 0) {
        nextSubjects.forEach((item, index) => {
            const subjectElement = document.createElement('div');
            subjectElement.className = `flex items-center p-2 ${index % 2 === 0 ? 'bg-purple-50' : 'bg-blue-50'} rounded-lg`;
            subjectElement.innerHTML = `
                <div class="w-10 h-10 rounded-full ${index % 2 === 0 ? 'bg-purple-100' : 'bg-blue-100'} flex items-center justify-center mr-3">
                    <i data-feather="book" class="${index % 2 === 0 ? 'text-purple-600' : 'text-blue-600'}"></i>
                </div>
                <div>
                    <div class="font-medium">${item.subject}</div>
                    <div class="text-sm text-gray-500">${item.day} • ${item.startTime}</div>
                </div>
            `;
            nextSubjectsContainer.appendChild(subjectElement);
        });
    } else {
        nextSubjectsContainer.innerHTML = `
            <div class="text-center py-4 text-gray-500">
                <p>Aucune matière programmée</p>
            </div>
        `;
    }
    
    feather.replace();
}

// Update reminders display
function updateRemindersDisplay() {
    const reminders = JSON.parse(localStorage.getItem('reminders')) || [];
    const reminderDisplay = document.getElementById('reminder-display');
    
    if (reminders.length > 0) {
        // Filter out the "Révision des formules des alcanes" reminder
        const filteredReminders = reminders.filter(reminder => 
            !reminder.title.includes('Révision') || 
            !reminder.details.includes('formules des alcanes')
        );
        
        if (filteredReminders.length > 0) {
            reminderDisplay.innerHTML = `
                <div class="flex items-start p-3 bg-yellow-50 rounded-lg border border-yellow-200">
                    <i data-feather="bell" class="text-yellow-500 mr-2 mt-0.5"></i>
                    <div>
                        <div class="font-medium">${filteredReminders[0].title}</div>
                        <div class="text-sm text-gray-600">${filteredReminders[0].details}</div>
                    </div>
                </div>
            `;
            feather.replace();
        } else {
            reminderDisplay.innerHTML = '';
        }
    } else {
        reminderDisplay.innerHTML = '';
    }
}

// Initialize the new functions
document.addEventListener('DOMContentLoaded', function() {
    loadNextExam();
    loadNextSubjects();
    updateRemindersDisplay();
    
    // Update when schedules change
    window.addEventListener('storage', function() {
        loadNextExam();
        loadNextSubjects();
        updateRemindersDisplay();
    });
});
        // Countdown timer (example for BAC 2026)
        function updateCountdown() {
            const bacDate = new Date('2026-06-15T08:00:00');
            const now = new Date();
            const diff = bacDate - now;
            
            if (diff > 0) {
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((diff % (1000 * 60)) / 1000);
                
                document.getElementById('countdown').textContent = 
                    `BAC 2026: ${days}j ${hours}h ${minutes}m ${seconds}s`;
            } else {
                document.getElementById('countdown').textContent = "BAC 2026: Terminé!";
            }
        }
        setInterval(updateCountdown, 1000);
        updateCountdown();
        
        // Sample reminder
        const reminders = [
            { title: "Révision", description: "Réviser les formules des alcanes" },
            { title: "Histoire", description: "Apprendre la leçon L1 sur la révolution" }
        ];
        
        const reminderDisplay = document.getElementById('reminder-display');
        if (reminders.length > 0) {
            reminderDisplay.innerHTML = `
                <div class="flex items-start p-3 bg-yellow-50 rounded-lg border border-yellow-200">
                    <i data-feather="bell" class="text-yellow-500 mr-2 mt-0.5"></i>
                    <div>
                        <div class="font-medium">${reminders[0].title}</div>
                        <div class="text-sm text-gray-600">${reminders[0].description}</div>
                    </div>
                </div>
            `;
            feather.replace();
        }
        
        // Evolution Chart
        const ctx = document.getElementById('evolutionChart').getContext('2d');
        const evolutionChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['Trim 1', 'Trim 2', 'Trim 3', 'Trim 1', 'Trim 2'],
                datasets: [{
                    label: 'Moyenne générale',
                    data: [12.5, 13.2, 14.0, 14.5, 15.2],
                    borderColor: '#6C63FF',
                    backgroundColor: 'rgba(108, 99, 255, 0.1)',
                    tension: 0.3,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: false,
                        min: 10,
                        max: 20
                    }
                }
            }
        });
        
        // Prevent blue highlight on mobile taps
        document.addEventListener('touchstart', function() {}, true);
    </script>
</body>
</html>
