<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StudySync - Accueil</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <style>
        :root {
            --primary: #6C63FF;
            --secondary: #4D44DB;
            --accent: #FF6584;
            --light: #F8F9FA;
            --dark: #343A40;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F5F7FB;
        }
        .greeting {
            animation: fadeIn 1s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .subject-card {
            transition: all 0.3s ease;
        }
        .subject-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .countdown {
            font-feature-settings: "tnum";
        }
        .nav-item.active {
            border-bottom: 3px solid var(--primary);
        }
        input:focus, textarea:focus, select:focus {
            outline: none !important;
            box-shadow: 0 0 0 2px rgba(108, 99, 255, 0.2) !important;
        }
        [contenteditable]:focus {
            outline: none;
        }
      .add-btn {
  position: fixed;
  top: 15px;
  left: 15px;
  background: #2563eb;
  color: white;
  font-size: 28px;
  border: none;
  border-radius: 50%;
  width: 50px;
  height: 50px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.2);
  cursor: pointer;
  z-index: 999;
}

.exam-list {
  margin-top: 80px;
  padding: 20px;
}
.reminder-item {
    max-height: none !important;
    overflow: visible !important;
}

.reminder-details {
    white-space: normal !important;
    word-wrap: break-word !important;
    max-height: none !important;
    overflow: visible !important;
}
    </style>
</head>
<body class="min-h-screen flex flex-col">
    <!-- Header -->
    <header class="bg-white shadow-sm sticky top-0 z-10">
        <div class="container mx-auto px-4 py-3 flex items-center justify-between">
            <div class="flex items-center space-x-2">
                <i data-feather="book-open" class="text-purple-600"></i>
                <h1 class="text-xl font-bold text-gray-800">StudySync</h1>
            </div>
            
            <div class="relative w-1/2">
                <input type="text" placeholder="Rechercher une matière, document..." 
                       class="w-full px-4 py-2 rounded-full border border-gray-200 focus:border-purple-400 focus:ring-0">
                <i data-feather="search" class="absolute right-3 top-2.5 text-gray-400"></i>
            </div>
            
            <div class="flex items-center space-x-4">
                <div id="greeting" class="greeting font-medium text-gray-700">Bonjour</div>
                <div class="w-8 h-8 rounded-full bg-purple-100 flex items-center justify-center">
                    <i data-feather="user" class="text-purple-600"></i>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow container mx-auto px-4 py-6">
        <!-- Date & Countdown -->
      <!-- Date & Countdown -->
<section class="mb-8 bg-white rounded-xl shadow-sm p-6">
    <div class="flex flex-wrap items-center justify-between gap-4">
        <div class="flex items-center space-x-4">
            <div class="w-12 h-12 rounded-full bg-purple-100 flex items-center justify-center">
                <i data-feather="calendar" class="text-purple-600"></i>
            </div>
            <div>
                <div class="text-gray-500">Aujourd'hui</div>
                <div id="current-date" class="font-semibold text-lg">Lundi 12 juin 2023</div>
                <div id="current-time" class="font-semibold text-purple-600 text-sm"></div>
            </div>
        </div>
        
<div id="reminder-display" class="flex-grow max-w-md px-4 cursor-pointer" onclick="openReminderPage()">
    <div class="flex items-center justify-center p-3 bg-yellow-50 rounded-lg border border-yellow-200">
        <i data-feather="bell" class="text-yellow-500 mr-2"></i>
        <span class="font-medium text-gray-700">RAPPEL</span>
    </div>
</div>
    </div>
</section>
<!-- PAGE EXAMENS -->
      
      
<!-- Prochain Examen -->
<section class="mb-8 bg-white rounded-xl shadow-sm p-6">
    <div class="flex justify-center items-center">
        <button onclick="openExamPage()" class="text-gray-500 hover:text-purple-600 transition flex flex-col items-center text-center">
            <i data-feather="clock" class="w-6 h-6 mb-2 text-purple-600"></i>
            <div>Prochain examen</div>
            <div id="next-exam" class="font-bold text-purple-600 underline">Chargement...</div>
        </button>
    </div>
</section>

        <!-- Tomorrow's Schedule -->
     <!-- Prochaines matières -->
<section class="mb-8">
    <h2 class="text-xl font-semibold mb-4 flex items-center">
        <i data-feather="clock" class="mr-2"></i> À suivre
    </h2>
    <div class="bg-white rounded-xl shadow-sm p-4">
        <div class="flex justify-between items-center mb-3">
            <h3 class="font-medium">Prochaines matières</h3>
            <a href="schedule.html" class="text-sm text-purple-600 flex items-center">
                Voir plus <i data-feather="chevron-right" class="ml-1 w-4 h-4"></i>
            </a>
        </div>
        <div id="next-subjects" class="space-y-3">
            <!-- Les 2 prochaines matières seront affichées ici dynamiquement -->
        </div>
    </div>
</section>

        <!-- Bulletin & Evolution -->
        <section class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
            <!-- Bulletin -->
            <div class="bg-white rounded-xl shadow-sm p-6">
                <h2 class="text-xl font-semibold mb-4 flex items-center">
                    <i data-feather="file-text" class="mr-2"></i> Bulletin de notes
                </h2>
                <div class="mb-4">
                    <div class="text-gray-500 mb-1">Dernier bulletin</div>
                    <div class="font-medium">1er Trimestre 2023-2024</div>
                    <div class="text-sm text-gray-500">Moyenne: 14.5/20</div>
                </div>
                <a href="grades.html" class="inline-flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition">
                    <i data-feather="plus" class="mr-2 w-4 h-4"></i> Nouveau bulletin
                </a>
            </div>
            
            <!-- Evolution -->
            <div class="bg-white rounded-xl shadow-sm p-6">
                <h2 class="text-xl font-semibold mb-4 flex items-center">
                    <i data-feather="trending-up" class="mr-2"></i> Évolution
                </h2>
                <div class="h-48">
                    <canvas id="evolutionChart"></canvas>
                </div>
                <div class="mt-4 text-right">
                    <a href="grades.html#evolution" class="text-purple-600 text-sm flex items-center justify-end">
                        Voir le détail <i data-feather="chevron-right" class="ml-1 w-4 h-4"></i>
                    </a>
                </div>
            </div>
        </section>

        <!-- Matières récentes -->
        <section>
            <h2 class="text-xl font-semibold mb-4 flex items-center">
                <i data-feather="layers" class="mr-2"></i> Mes matières récentes
            </h2>
            <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4">
                <a href="subject.html?id=1" class="subject-card bg-white rounded-xl shadow-sm p-4 flex flex-col items-center text-center hover:shadow-md">
                    <div class="w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center mb-2">
                        <i data-feather="code" class="text-blue-600"></i>
                    </div>
                    <div class="font-medium">Informatique</div>
                    <div class="text-xs text-gray-500">Coeff: 3</div>
                </a>
                <a href="subject.html?id=2" class="subject-card bg-white rounded-xl shadow-sm p-4 flex flex-col items-center text-center hover:shadow-md">
                    <div class="w-12 h-12 rounded-full bg-red-100 flex items-center justify-center mb-2">
                        <i data-feather="atom" class="text-red-600"></i>
                    </div>
                    <div class="font-medium">Physique</div>
                    <div class="text-xs text-gray-500">Coeff: 4</div>
                </a>
                <a href="subject.html?id=3" class="subject-card bg-white rounded-xl shadow-sm p-4 flex flex-col items-center text-center hover:shadow-md">
                    <div class="w-12 h-12 rounded-full bg-green-100 flex items-center justify-center mb-2">
                        <i data-feather="divide" class="text-green-600"></i>
                    </div>
                    <div class="font-medium">Maths</div>
                    <div class="text-xs text-gray-500">Coeff: 5</div>
                </a>
                <a href="subject.html?id=4" class="subject-card bg-white rounded-xl shadow-sm p-4 flex flex-col items-center text-center hover:shadow-md">
                    <div class="w-12 h-12 rounded-full bg-yellow-100 flex items-center justify-center mb-2">
                        <i data-feather="globe" class="text-yellow-600"></i>
                    </div>
                    <div class="font-medium">Histoire</div>
                    <div class="text-xs text-gray-500">Coeff: 2</div>
                </a>
            </div>
        </section>
      


    </main>

     <!-- Page Examens -->
<div id="exam-page" class="hidden fixed inset-0 bg-white z-50 p-6 overflow-y-auto">
    <div class="flex items-center justify-between mb-6">
      <button onclick="closeExamPage()" class="text-gray-500 hover:text-purple-600">
    <i data-feather="arrow-left"></i> Retour
</button>
        <h2 class="text-xl font-semibold flex items-center">
            <i data-feather="calendar" class="mr-2"></i> Mes examens
        </h2>
        <button onclick="openExamForm()" class="bg-purple-600 text-white rounded-full p-2 hover:bg-purple-700">
            <i data-feather="plus"></i>
        </button>
    </div>

    <div id="exam-list" class="space-y-3">
        <!-- Les examens seront affichés ici -->
    </div>

    <!-- Fenêtre de formulaire -->
    <div id="exam-form" class="hidden fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center">
        <div class="bg-white rounded-xl p-6 w-80">
            <h3 class="text-lg font-semibold mb-3">Nouvel examen</h3>
            <input id="exam-name" type="text" placeholder="Nom de l'examen" class="w-full border rounded-lg p-2 mb-2">
            <input id="exam-date" type="date" class="w-full border rounded-lg p-2 mb-2">
            <input id="exam-time" type="time" class="w-full border rounded-lg p-2 mb-4">
            <div class="flex justify-end space-x-2">
                <button onclick="closeExamForm()" class="px-3 py-1 rounded-lg border">Annuler</button>
                <button onclick="addExam()" class="px-3 py-1 bg-purple-600 text-white rounded-lg">Ajouter</button>
            </div>
        </div>
    </div>
</div>
  
  <!-- Page Rappels -->
<div id="reminder-page" class="hidden fixed inset-0 bg-white z-50 p-6 overflow-y-auto">
    <div class="flex items-center justify-between mb-6">
        <button onclick="closeReminderPage()" class="text-gray-500 hover:text-purple-600">
            <i data-feather="arrow-left"></i> Retour
        </button>
        <h2 class="text-xl font-semibold flex items-center">
            <i data-feather="bell" class="mr-2"></i> Mes rappels
        </h2>
        <button onclick="openReminderForm()" class="bg-purple-600 text-white rounded-full p-2 hover:bg-purple-700">
            <i data-feather="plus"></i>
        </button>
    </div>

    <div id="reminder-list" class="space-y-3">
        <!-- Les rappels seront affichés ici -->
    </div>

    <!-- Fenêtre de formulaire -->
    <div id="reminder-form" class="hidden fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-60">
        <div class="bg-white rounded-xl p-6 w-80">
            <h3 class="text-lg font-semibold mb-3">Nouveau rappel</h3>
            <input id="reminder-title" type="text" placeholder="Titre" class="w-full border rounded-lg p-2 mb-2">
            <textarea id="reminder-details" type="text" placeholder="Détails (optionnel)" class="w-full border rounded-lg p-2 mb-4 h-20"></textarea>
            <input id="reminder-date" type="date" class="w-full border rounded-lg p-2 mb-4">
            <div class="flex justify-end space-x-2">
                <button onclick="closeReminderForm()" class="px-3 py-1 rounded-lg border">Annuler</button>
                <button onclick="addReminder()" class="px-3 py-1 bg-purple-600 text-white rounded-lg">Ajouter</button>
            </div>
        </div>
    </div>
</div>
    <!-- Bottom Navigation -->
    <nav class="bg-white border-t border-gray-200 fixed bottom-0 w-full">
        <div class="container mx-auto flex justify-around">
            <a href="index.html" class="nav-item active flex flex-col items-center py-3 px-4 text-purple-600">
                <i data-feather="home" class="w-6 h-6"></i>
                <span class="text-xs mt-1">Accueil</span>
            </a>
            <a href="subjects.html" class="nav-item flex flex-col items-center py-3 px-4 text-gray-500 hover:text-purple-600">
                <i data-feather="book" class="w-6 h-6"></i>
                <span class="text-xs mt-1">Matières</span>
            </a>
            <a href="library.html" class="nav-item flex flex-col items-center py-3 px-4 text-gray-500 hover:text-purple-600">
                <i data-feather="bookmark" class="w-6 h-6"></i>
                <span class="text-xs mt-1">Bibliothèque</span>
            </a>
            <a href="schedule.html" class="nav-item flex flex-col items-center py-3 px-4 text-gray-500 hover:text-purple-600">
                <i data-feather="calendar" class="w-6 h-6"></i>
                <span class="text-xs mt-1">Emploi du temps</span>
            </a>
            <a href="settings.html" class="nav-item flex flex-col items-center py-3 px-4 text-gray-500 hover:text-purple-600">
                <i data-feather="settings" class="w-6 h-6"></i>
                <span class="text-xs mt-1">Paramètres</span>
            </a>
        </div>
    </nav>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Initialize Feather Icons
      // Initialize the page
function initPage() {
    feather.replace();
    
    // Set current date and time
    const now = new Date();
    const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
    document.getElementById('current-date').textContent = now.toLocaleDateString('fr-FR', options);
    
    // Start real-time clock
    updateCurrentTime();
    setInterval(updateCurrentTime, 1000);
    
    // Dynamic greeting
    const hour = now.getHours();
    let greeting;
    
    if (hour < 12) {
        greeting = "Bonjour";
    } else if (hour < 18) {
        greeting = "Bonsoir";
    } else {
        greeting = "Bonsoir";
    }
    
    document.getElementById('greeting').textContent = greeting;
    
    // Load data from schedule page
    loadNextExam();
    loadNextSubjects();
    updateRemindersDisplay(); // Affiche toujours le bouton "cliquez pour ajouter"
    
    // Set up intervals to refresh data
   setInterval(() => {
    loadNextExam();
}, 1000); // Refresh every minute
    setInterval(loadNextSubjects, 60000); // Refresh every minute
}
        
      
   // Update current time
function updateCurrentTime() {
    const now = new Date();
    const timeString = now.toLocaleTimeString('fr-FR', { 
        hour: '2-digit', 
        minute: '2-digit',
        second: '2-digit'
    });
    document.getElementById('current-time').textContent = timeString;
}
setInterval(updateCurrentTime, 1000);
updateCurrentTime();

// Load next exam from schedule
function loadNextExam() {
    const exams = JSON.parse(localStorage.getItem('exams')) || [];
    const now = new Date();
    
    // Examen en cours (+1h)
    const ongoingExam = exams.find(exam => {
        const examStart = new Date(`${exam.date}T${exam.time}`);
        const examEnd = new Date(examStart.getTime() + 60 * 60 * 1000);
        return now >= examStart && now <= examEnd;
    });
    
    const nextExamElement = document.getElementById('next-exam');
    
    if (ongoingExam) {
        nextExamElement.textContent = `${ongoingExam.name} - En cours`;
        return;
    }
    
    // Examen futur le plus proche
    const futureExams = exams
        .filter(exam => new Date(`${exam.date}T${exam.time}`) > now)
        .sort((a, b) => new Date(`${a.date}T${a.time}`) - new Date(`${b.date}T${b.time}`));

    if (futureExams.length > 0) {
        const nextExam = futureExams[0];
        const examDate = new Date(`${nextExam.date}T${nextExam.time}`);
        const diff = examDate - now;

        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
        const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const mins = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        const secs = Math.floor((diff % (1000 * 60)) / 1000);

        nextExamElement.innerHTML = `${nextExam.name} dans <span id="countdown-home">${days}J-${hours}H-${mins}MN-${secs}S</span>`;
    } else {
        nextExamElement.textContent = "Aucun examen prévu";
    }
}

 
// Load next  subjects
// Load next subjects from schedules
function loadNextSubjects() {
    const schedules = JSON.parse(localStorage.getItem('schedules')) || [];
    const now = new Date();
    const currentDay = now.toLocaleDateString('fr-FR', { weekday: 'long' });
    const currentTime = now.toTimeString().substring(0, 5); // HH:MM format
    
    // Tableau pour stocker toutes les matières futures
    let allFutureSubjects = [];
    
    // Parcourir tous les emplois du temps
    schedules.forEach(schedule => {
        if (schedule.data && schedule.days) {
            schedule.days.forEach(day => {
                if (schedule.data[day]) {
                    Object.keys(schedule.data[day]).forEach(timeSlotId => {
                        const subject = schedule.data[day][timeSlotId];
                        if (subject && subject.trim() !== '') {
                            // Trouver le créneau horaire correspondant
                            const timeSlot = schedule.timeSlots.find(ts => ts.id === timeSlotId);
                            if (timeSlot) {
                                // Calculer si c'est une matière future
                                const subjectDateTime = calculateSubjectDateTime(day, timeSlot.start, now);
                                
                                // Vérifier si c'est une matière future (aujourd'hui ou après)
                                if (subjectDateTime >= now) {
                                    allFutureSubjects.push({
                                        subject: subject,
                                        day: day,
                                        startTime: timeSlot.start,
                                        endTime: timeSlot.end,
                                        scheduleName: schedule.name,
                                        dateTime: subjectDateTime,
                                        scheduleColor: schedule.color
                                    });
                                }
                            }
                        }
                    });
                }
            });
        }
    });
    
    // Trier les matières par date/heure (les plus proches en premier)
    allFutureSubjects.sort((a, b) => a.dateTime - b.dateTime);
    
    // Prendre seulement les 2 prochaines matières
    const nextSubjects = allFutureSubjects.slice(0, 2);
    
    // Afficher les résultats
    const nextSubjectsContainer = document.getElementById('next-subjects');
    nextSubjectsContainer.innerHTML = '';
    
    if (nextSubjects.length > 0) {
        nextSubjects.forEach((item, index) => {
            const timeUntil = calculateTimeUntil(item.dateTime, now);
            
            const subjectElement = document.createElement('div');
            subjectElement.className = `flex items-center p-3 ${index % 2 === 0 ? 'bg-purple-50' : 'bg-blue-50'} rounded-lg border ${index % 2 === 0 ? 'border-purple-100' : 'border-blue-100'}`;
            subjectElement.innerHTML = `
                <div class="w-10 h-10 rounded-full ${index % 2 === 0 ? 'bg-purple-100' : 'bg-blue-100'} flex items-center justify-center mr-3">
                    <i data-feather="book" class="${index % 2 === 0 ? 'text-purple-600' : 'text-blue-600'}"></i>
                </div>
                <div class="flex-1">
                    <div class="font-medium">${item.subject}</div>
                    <div class="text-sm text-gray-600">
                        ${item.day} • ${item.startTime} - ${item.endTime}
                    </div>
                    <div class="text-xs ${index % 2 === 0 ? 'text-purple-500' : 'text-blue-500'} font-medium mt-1">
                        ${timeUntil}
                    </div>
                </div>
            `;
            nextSubjectsContainer.appendChild(subjectElement);
        });
    } else {
        nextSubjectsContainer.innerHTML = `
            <div class="text-center py-6 text-gray-500 bg-gray-50 rounded-lg">
                <i data-feather="book-open" class="w-8 h-8 mx-auto mb-2"></i>
                <p>Aucune matière à venir</p>
                <p class="text-sm mt-1">Toutes les matières sont terminées pour aujourd'hui</p>
            </div>
        `;
    }
    
    feather.replace();
}

// Fonction pour calculer la date/heure d'une matière
function calculateSubjectDateTime(day, startTime, currentDate) {
    const daysOfWeek = ['Dimanche', 'Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi'];
    const targetDayIndex = daysOfWeek.indexOf(day);
    const currentDayIndex = currentDate.getDay();
    
    // Calculer le nombre de jours jusqu'au jour cible
    let daysToAdd = targetDayIndex - currentDayIndex;
    if (daysToAdd < 0) {
        daysToAdd += 7; // Semaine suivante
    }
    
    // Créer la date cible
    const targetDate = new Date(currentDate);
    targetDate.setDate(currentDate.getDate() + daysToAdd);
    
    // Ajouter l'heure de début
    const [hours, minutes] = startTime.split(':');
    targetDate.setHours(parseInt(hours), parseInt(minutes), 0, 0);
    
    return targetDate;
}

// Fonction pour calculer le temps restant jusqu'à la matière
function calculateTimeUntil(targetDate, currentDate) {
    const diff = targetDate - currentDate;
    const diffMinutes = Math.floor(diff / (1000 * 60));
    const diffHours = Math.floor(diffMinutes / 60);
    const diffDays = Math.floor(diffHours / 24);
    
    if (diffDays > 0) {
        return `Dans ${diffDays} jour${diffDays > 1 ? 's' : ''}`;
    } else if (diffHours > 0) {
        const remainingMinutes = diffMinutes % 60;
        if (remainingMinutes > 0) {
            return `Dans ${diffHours}h ${remainingMinutes}min`;
        }
        return `Dans ${diffHours} heure${diffHours > 1 ? 's' : ''}`;
    } else if (diffMinutes > 0) {
        return `Dans ${diffMinutes} minute${diffMinutes > 1 ? 's' : ''}`;
    } else {
        return 'Maintenant';
    }
}

      // Fonction utilitaire pour formater la date
function formatDate(date) {
    return date.toLocaleDateString('fr-FR', { 
        weekday: 'long', 
        day: 'numeric', 
        month: 'long' 
    });
}
      
// Update reminders display
function updateRemindersDisplay() {
    const reminderDisplay = document.getElementById('reminder-display');
    
    // TOUJOURS afficher le même message, même s'il y a des rappels
    reminderDisplay.innerHTML = `
        <div class="flex items-center justify-center p-3 bg-yellow-50 rounded-lg border border-yellow-200 cursor-pointer" onclick="openReminderPage()">
            <i data-feather="bell" class="text-yellow-500 mr-2"></i>
            <span class="font-medium text-gray-700">Gérer vos rappels</span>
        </div>
    `;
    feather.replace();
}
      
      // --- PAGE DE RAPPELS --- //
function openReminderPage() {
    document.getElementById('reminder-page').classList.remove('hidden');
    document.querySelector('main').classList.add('hidden');
    document.querySelector('nav').classList.add('hidden');
    renderReminders();
    feather.replace();
    window.reminderInterval = setInterval(renderReminders, 1000);
}

function openReminderForm() {
    document.getElementById('reminder-form').classList.remove('hidden');
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('reminder-date').value = today;
}

function closeReminderForm() {
    document.getElementById('reminder-form').classList.add('hidden');
}

function addReminder() {
    const title = document.getElementById('reminder-title').value.trim();
    const details = document.getElementById('reminder-details').value.trim();
    const date = document.getElementById('reminder-date').value;
    if (!title || !date) return alert("Titre et date obligatoires !");
    
    const reminders = JSON.parse(localStorage.getItem('reminders')) || [];
    reminders.push({ title, details, date });
    localStorage.setItem('reminders', JSON.stringify(reminders));
    
    document.getElementById('reminder-title').value = '';
    document.getElementById('reminder-details').value = '';
    document.getElementById('reminder-date').value = '';
    
    closeReminderForm();
    renderReminders();
}

      
      function editReminder(index) {
    const reminders = JSON.parse(localStorage.getItem('reminders')) || [];
    const reminder = reminders[index];
    document.getElementById('reminder-title').value = reminder.title;
    document.getElementById('reminder-details').value = reminder.details || '';
    document.getElementById('reminder-date').value = reminder.date;
    closeReminderForm(); // Ferme si ouvert
    openReminderForm();
    // Pour save, modifiez addReminder en update si index existe
    window.currentEditIndex = index;
}
      
function renderReminders() {
    const list = document.getElementById('reminder-list');
    const reminders = JSON.parse(localStorage.getItem('reminders')) || [];
    list.innerHTML = '';

    if (reminders.length === 0) {
        list.innerHTML = `<div class="text-center text-gray-500">Aucun rappel ajouté</div>`;
        return;
    }

    const now = new Date();
    reminders.sort((a, b) => new Date(a.date) - new Date(b.date)); // Tri par date

    reminders.forEach((reminder, index) => {
        const remDate = new Date(reminder.date);
        const diff = remDate - now;
        let status = 'Futur';
        if (diff < 0) status = 'Passé';

        const div = document.createElement('div');
        div.className = "p-4 border rounded-lg flex justify-between items-start";
        div.innerHTML = `
            <div class="flex-1">
                <div class="font-medium">${reminder.title}</div>
                <div class="text-sm text-gray-500">${reminder.date}</div>
                ${reminder.details ? `<div class="text-sm text-gray-600 mt-1 break-words">${reminder.details}</div>` : ''}
                <div class="text-xs text-gray-400">Statut: ${status}</div>
            </div>
           <div class="flex items-center ml-4 space-x-2">
    <button onclick="editReminder(${index})" class="text-blue-500 hover:text-blue-700">
        <i data-feather="edit-3" class="w-4 h-4"></i>
    </button>
    <button onclick="deleteReminder(${index})" class="text-red-500 hover:text-red-700">
        <i data-feather="trash-2" class="w-4 h-4"></i>
    </button>
</div>
        `;
        list.appendChild(div);
    });
    feather.replace();
}

function closeReminderPage() {
    document.getElementById('reminder-page').classList.add('hidden');
    document.querySelector('main').classList.remove('hidden');
    document.querySelector('nav').classList.remove('hidden');
    if (window.reminderInterval) clearInterval(window.reminderInterval);
}

function deleteReminder(index) {
    const reminders = JSON.parse(localStorage.getItem('reminders')) || [];
    reminders.splice(index, 1);
    localStorage.setItem('reminders', JSON.stringify(reminders));
    renderReminders();
}

// Initialize the new functions
// Initialize the new functions
document.addEventListener('DOMContentLoaded', function() {
    loadNextExam();
    loadNextSubjects();
    updateRemindersDisplay();
    
    // Mise à jour du compte à rebours toutes les secondes sur l'accueil
    setInterval(loadNextExam, 1000);
   setInterval(loadNextSubjects, 60000);
    
    // Update when schedules change
    window.addEventListener('storage', function() {
        loadNextExam();
        loadNextSubjects();
        updateRemindersDisplay();
    });
});
        // Countdown timer (example for BAC 2026)
        function updateCountdown() {
            const bacDate = new Date('2026-06-15T08:00:00');
            const now = new Date();
            const diff = bacDate - now;
            
            if (diff > 0) {
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((diff % (1000 * 60)) / 1000);
                
                document.getElementById('countdown').textContent = 
                    `BAC 2026: ${days}j ${hours}h ${minutes}m ${seconds}s`;
            } else {
                document.getElementById('countdown').textContent = "BAC 2026: Terminé!";
            }
        }
        setInterval(updateCountdown, 1000);
        updateCountdown();
        
        // Sample reminder
        const reminders = [
            { title: "Révision", description: "Réviser les formules des alcanes" },
            { title: "Histoire", description: "Apprendre la leçon L1 sur la révolution" }
        ];
        
        const reminderDisplay = document.getElementById('reminder-display');
        if (reminders.length > 0) {
            reminderDisplay.innerHTML = `
                <div class="flex items-start p-3 bg-yellow-50 rounded-lg border border-yellow-200">
                    <i data-feather="bell" class="text-yellow-500 mr-2 mt-0.5"></i>
                    <div>
                        <div class="font-medium">${reminders[0].title}</div>
                        <div class="text-sm text-gray-600">${reminders[0].description}</div>
                    </div>
                </div>
            `;
            feather.replace();
        }
        
        // Evolution Chart
        const ctx = document.getElementById('evolutionChart').getContext('2d');
        const evolutionChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['Trim 1', 'Trim 2', 'Trim 3', 'Trim 1', 'Trim 2'],
                datasets: [{
                    label: 'Moyenne générale',
                    data: [12.5, 13.2, 14.0, 14.5, 15.2],
                    borderColor: '#6C63FF',
                    backgroundColor: 'rgba(108, 99, 255, 0.1)',
                    tension: 0.3,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: false,
                        min: 10,
                        max: 20
                    }
                }
            }
        });
        
        // Prevent blue highlight on mobile taps
        document.addEventListener('touchstart', function() {}, true);
      
      // --- PAGE D'EXAMENS --- //
function openExamPage() {
    document.getElementById('exam-page').classList.remove('hidden');
    document.querySelector('main').classList.add('hidden');
    document.querySelector('nav').classList.add('hidden');
    renderExams();
    feather.replace();
    
    // Interval local
    window.examInterval = setInterval(() => {
        renderExams();
        loadNextExam();
    }, 1000);
}

function openExamForm() {
    document.getElementById('exam-form').classList.remove('hidden');
}

function closeExamForm() {
    document.getElementById('exam-form').classList.add('hidden');
}

function addExam() {
    const name = document.getElementById('exam-name').value.trim();
    const date = document.getElementById('exam-date').value;
    const time = document.getElementById('exam-time').value;
    if (!name || !date || !time) return alert("Veuillez remplir tous les champs !");
    
    const exams = JSON.parse(localStorage.getItem('exams')) || [];
    exams.push({ name, date, time });
    localStorage.setItem('exams', JSON.stringify(exams));
    
    document.getElementById('exam-name').value = '';
    document.getElementById('exam-date').value = '';
    document.getElementById('exam-time').value = '';
    
    closeExamForm();
    renderExams();
    loadNextExam(); // actualise aussi l’accueil
}

function renderExams() {
    const list = document.getElementById('exam-list');
    const exams = JSON.parse(localStorage.getItem('exams')) || [];
    list.innerHTML = '';

    if (exams.length === 0) {
        list.innerHTML = `<div class="text-center text-gray-500">Aucun examen ajouté</div>`;
        return;
    }

    const now = new Date();
    exams.forEach((exam, index) => {
        const examDate = new Date(`${exam.date}T${exam.time}`);
        const diff = examDate - now;

        let countdown = 'Terminé';
        if (diff > 0) {
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const mins = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const secs = Math.floor((diff % (1000 * 60)) / 1000);
            countdown = `${days}J-${hours}H-${mins}MN-${secs}S`;
        }

        const div = document.createElement('div');
        div.className = "p-4 border rounded-lg flex justify-between items-center";
        div.innerHTML = `
            <div>
                <div class="font-medium">${exam.name}</div>
                <div class="text-sm text-gray-500">${exam.date} • ${exam.time}</div>
            </div>
            <div class="flex items-center">
                <div class="text-purple-600 font-semibold mr-4">${countdown}</div>
                <button onclick="deleteExam(${index})" class="text-red-500 hover:text-red-700">
                    <i data-feather="trash-2" class="w-4 h-4"></i>
                </button>
            </div>
        `;
        list.appendChild(div);
    });
    feather.replace();
}

// --- Mise à jour du compte à rebours en direct --- //
setInterval(() => {
    if (!document.getElementById('exam-page').classList.contains('hidden')) {
        renderExams();
    }
    loadNextExam();
}, 1000);

function closeExamPage() {
    document.getElementById('exam-page').classList.add('hidden');
    document.querySelector('main').classList.remove('hidden');
    document.querySelector('nav').classList.remove('hidden');
    if (window.examInterval) clearInterval(window.examInterval);
}

function deleteExam(index) {
    const exams = JSON.parse(localStorage.getItem('exams')) || [];
    exams.splice(index, 1);
    localStorage.setItem('exams', JSON.stringify(exams));
    renderExams();
    loadNextExam();
}
      
      function startHomeCountdown() {
    setInterval(() => {
        const exams = JSON.parse(localStorage.getItem('exams')) || [];
        const now = new Date();
        
        const ongoingExam = exams.find(exam => {
            const examStart = new Date(`${exam.date}T${exam.time}`);
            const examEnd = new Date(examStart.getTime() + 60 * 60 * 1000);
            return now >= examStart && now <= examEnd;
        });
        
        const nextExamElement = document.getElementById('next-exam');
        if (ongoingExam) {
            nextExamElement.textContent = `${ongoingExam.name} - En cours`;
            return;
        }
        
        const futureExams = exams.filter(exam => new Date(`${exam.date}T${exam.time}`) > now)
            .sort((a, b) => new Date(`${a.date}T${a.time}`) - new Date(`${b.date}T${b.time}`));
        
        if (futureExams.length > 0) {
            const nextExam = futureExams[0];
            const examDate = new Date(`${nextExam.date}T${nextExam.time}`);
            const diff = examDate - now;
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const mins = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const secs = Math.floor((diff % (1000 * 60)) / 1000);
            nextExamElement.innerHTML = `${nextExam.name} dans <span class="countdown-home">${days}J-${hours}H-${mins}MN-${secs}S</span>`;
        } else {
            nextExamElement.textContent = "Aucun examen prévu";
        }
    }, 1000);
}
    </script>
</body>
</html>
